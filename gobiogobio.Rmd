---
title: "gobiogobio"
output: pdf_document
date: "2026-02-03"
---

## Agro Toulouse

## 2A FISA

## Projet UE Conception Numérique

### Traitement des données Naïades sur les goujons

### -------------------------

### R Script edited by Lorys David and Sigala Maélie

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Mise à jour de la console :

```{r}
graphics.off()
rm(list = ls())
```

Chargement des librairies

```{r}
library(dplyr)
library(readr)
library(tidyr)
library(lubridate)
library(ggplot2)
```

## Importation des données Naïades format csv sur R

Nous avons un dossier zip constitué de 5 fichiers Excel:

-   Conditions environnementales
-   Listes Faune/Flore
-   Opérations
-   Résultats biologiques
-   Stations

Les fichiers qui nous intéressent sont ceux qui répertorient le nombre de poissons par prélèvement (listes Faune/flore) et les données géographiques des stations (Stations) pour réaliser une cartographie.

```{r}
# Importer les données recensement IPR sur les mêmes périodes
ipr <- read.csv("C:/Users/maeli/Desktop/naiades_ipr/ListesFauneFlore.csv", 
                    header=TRUE, 
                    stringsAsFactors = TRUE, 
                    sep = ';')
View(ipr)

# Regroupons les goujons recensés par date de pêche 

# Regroupons les espèces de goujons ensemble 
taxons_gobio <- c("Gobio", "Gobio gobio", "Gobio occitanae", "Gobio lozanoi")

gobio <- ipr[ipr$NomLatinAppelTaxon %in% taxons_gobio, ]
View(gobio)

# Regrouper par date et compter les occurrences
resultat <- aggregate(gobio$NomLatinAppelTaxon,
                      by = list(Date = gobio$DateDebutOperationPrelBio),
                      FUN = length)

names(resultat)[2] <- "Nombre de goujons"
View(resultat)
```

Combien y'a t'il de goujons prélevés sur 2022 et 2025 toutes stations confondues ?

```{r}
total_gobio = sum(resultat$`Nombre de goujons`, na.rm = TRUE)
total_gobio
```

Réalisons un tableau d'abondance en moyenne par mois sur chaque année :

```{r}
# Regroupement par mois et année
gobio_mensuel <- gobio %>%
  mutate(
    Annee = year(DateDebutOperationPrelBio),
    Mois = month(DateDebutOperationPrelBio, label = TRUE, abbr = FALSE)
  ) %>%
  group_by(Annee, Mois) %>%
  summarise(Nombre_prelevements = n()) %>%
  arrange(Annee, Mois)

gobio_mensuel
```

Regroupons par mois (toutes années confondues) pour analyser s'il y a des tendances saisonnières de présence des goujons :

```{r}
# Vecteur des mois en français pour l'ordre
mois_fr <- c("janvier", "février", "mars", "avril", "mai", "juin",
             "juillet", "août", "septembre", "octobre", "novembre", "décembre")

gobio_mensuel_global <- gobio %>%
  mutate(
    # Conversion explicite en date
    DateDebutOperationPrelBio = as.Date(DateDebutOperationPrelBio),

    # Extraction du mois
    Mois = month(DateDebutOperationPrelBio, label = TRUE, abbr = FALSE)
  ) %>%
  group_by(Mois) %>%
  summarise(Nombre_prelevements = n()) %>%
  arrange(match(Mois, mois_fr))
View(gobio_mensuel_global)
```

Nous pouvons en déduire que les périodes de recensemment se réalise de mai à octobre et qu'il y a une plus forte présence de goujons au mois de septembre (effet post-reproduction)

Combien de y'a t'il de stations de pêche pour le recensement ?

```{r}
ipr %>%
  distinct(LbStationMesureEauxSurface) %>%
  nrow()
```

Combien de prélèvements par an et par stations ?

```{r}
# Conversion de la date + extraction de l'année
ipr <- ipr %>%
  mutate(DateDebutOperationPrelBio = as.Date(DateDebutOperationPrelBio),
         Annee = year(DateDebutOperationPrelBio))

# Comptage par année et par station
prelevements_station_annee <- ipr %>%
  group_by(LbStationMesureEauxSurface, Annee) %>%
  summarise(
    NbPrelevements = n(),
    .groups = "drop"
  )

# Affichage
View(prelevements_station_annee)
```

Moyenne de nb de prélèvements par an et par station :

```{r}
# Calcul du nombre de prélèvements par station et par année
gobio_moyenne_station_annee <- ipr %>%
  mutate(Annee = year(DateDebutOperationPrelBio)) %>%
  group_by(LbStationMesureEauxSurface, Annee) %>%
  summarise(Nombre_prelevements = n()) %>%
  ungroup() %>%
  group_by(LbStationMesureEauxSurface) %>%
  summarise(Moyenne_prelevements_par_an = mean(Nombre_prelevements)) %>%
  arrange(desc(Moyenne_prelevements_par_an))

gobio_moyenne_station_annee
```

Nous pouvons observer un déséquilibre d'opération de prélèvements/an sur les différentes stations. max= 33; min=1

## Vérifier les absences de resencement de goujons par date d'opération de prélèvement ipr par stations :

```{r}
# 1. Toutes les combinaisons Date × Station
dates_stations <- ipr %>%
  distinct(DateDebutOperationPrelBio, LbStationMesureEauxSurface)

# 2. Comptage des Gobio par date × station
gobio_counts <- ipr %>%
  filter(NomLatinAppelTaxon %in% taxons_gobio) %>%
  group_by(DateDebutOperationPrelBio, LbStationMesureEauxSurface) %>%
  summarise(
    nb_gobio = sum(RsTaxRep, na.rm = TRUE),
    .groups = "drop"
  )

# 3. Jointure + complétion des absences
gobio_absences <- dates_stations %>%
  left_join(gobio_counts,
            by = c("DateDebutOperationPrelBio", "LbStationMesureEauxSurface")) %>%
  mutate(
    nb_gobio = replace_na(nb_gobio, 0),
    gobio_present = nb_gobio > 0,
    gobio_absent = !gobio_present
  )
# 4. Ajout des coordonnées géographiques des stations 
cdstations <- read.csv("C:/Users/maeli/Desktop/naiades_ipr/Stations.csv", 
                    header=TRUE, 
                    stringsAsFactors = TRUE, 
                    sep = ';')
View(cdstations)

cdstationsXY <- cdstations %>%
  select(LbStationMesureEauxSurface, CoordXStationMesureEauxSurface, CoordYStationMesureEauxSurface)

gobio_absences_geo <- gobio_absences %>%
  left_join(cdstationsXY, by = "LbStationMesureEauxSurface")

View(gobio_absences_geo)
```

## Pour exporter le fichier en csv :

```{r}
# Rendre le tableau plus propre en enlevant les colonnes absence/présence (remplacer par des valeurs numériques)

gobio <- gobio_absences_geo %>%
  select(-gobio_absent, -gobio_present)

View(gobio)

# Export CSV
write.csv(
  gobio,
  "C:/Users/maeli/Desktop/naiades_ipr/gobio.csv",
  row.names = FALSE
)
```

\`\`\`
